"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[7306],{12179:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"designing-studies/vega-stimulus","title":"Designing a Vega Stimulus","description":"Vega and Vega-Lite are popular visualization grammars for creating data visualizations.","source":"@site/versioned_docs/version-v2.0.0-rc6/designing-studies/vega-stimulus.md","sourceDirName":"designing-studies","slug":"/designing-studies/vega-stimulus","permalink":"/docs/v2.0.0-rc6/designing-studies/vega-stimulus","draft":false,"unlisted":false,"tags":[],"version":"v2.0.0-rc6","frontMatter":{},"sidebar":"docs","previous":{"title":"Designing a React Stimulus","permalink":"/docs/v2.0.0-rc6/designing-studies/react-stimulus"},"next":{"title":"Responses and Answers","permalink":"/docs/v2.0.0-rc6/designing-studies/answers-trainings"}}');var s=i(74848),a=i(28453);const o={},r="Designing a Vega Stimulus",c={},d=[{value:"1. Adding Vega Specs Directly to the reVISit Config",id:"1-adding-vega-specs-directly-to-the-revisit-config",level:3},{value:"2. Linking to Vega Specs in the reVISit Config",id:"2-linking-to-vega-specs-in-the-revisit-config",level:3},{value:"User Interactions and Data Passing",id:"user-interactions-and-data-passing",level:2},{value:"Capturing Responses",id:"capturing-responses",level:3},{value:"Example Config with Complete Vega Specifications",id:"example-config-with-complete-vega-specifications",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"designing-a-vega-stimulus",children:"Designing a Vega Stimulus"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://vega.github.io/vega/",children:"Vega"})," and ",(0,s.jsx)(n.a,{href:"https://vega.github.io/vega-lite/",children:"Vega-Lite"})," are popular visualization grammars for creating data visualizations.\nVega allows you to define the visual appearance and interactive behavior of a visualization in JSON format and generate web-based views using Canvas or SVG."]}),"\n",(0,s.jsxs)(n.p,{children:["A key benefit of using Vega with reVISit is that ",(0,s.jsx)(n.strong,{children:"you get provenance tracking (interaction logs) and the associated detailed replay of every single participants interactions for free!"})]}),"\n",(0,s.jsx)(n.p,{children:"This guide demonstrates how to integrate a Vega-based component into reVISit."}),"\n",(0,s.jsxs)(n.p,{children:["You can check out the ",(0,s.jsx)(n.a,{href:"https://revisit.dev/study/demo-vega/",children:"live demo"})," and the ",(0,s.jsx)(n.a,{href:"https://github.com/revisit-studies/study/tree/main/public/demo-vega",children:"code for these examples"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Also Review the relevant reference for"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://revisit.dev/docs/typedoc/interfaces/VegaComponentConfig/",children:"Vega Components"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://revisit.dev/docs/typedoc/interfaces/VegaComponentPath/",children:"Vega Paths"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"There are two ways to add a Vega component: directly in the config, and in an external file."}),"\n",(0,s.jsx)(n.h3,{id:"1-adding-vega-specs-directly-to-the-revisit-config",children:"1. Adding Vega Specs Directly to the reVISit Config"}),"\n",(0,s.jsxs)(n.p,{children:["To include Vega specifications directly in the reVISit configuration, set the ",(0,s.jsx)(n.code,{children:"type"})," field of your component to ",(0,s.jsx)(n.code,{children:"vega"})," and add your Vega specifications within the ",(0,s.jsx)(n.code,{children:"config"})," field, as shown below:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'"components": {\n  "vegademo1": {\n    ...\n    "type": "vega",\n    "config": {... your vega config...}\n    ...\n  }\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-linking-to-vega-specs-in-the-revisit-config",children:"2. Linking to Vega Specs in the reVISit Config"}),"\n",(0,s.jsx)(n.p,{children:"Including Vega specifications directly in the configuration may make your config file long and also mixes two languages. To address this, you can also manage the specifications in a separate file and link to it."}),"\n",(0,s.jsxs)(n.p,{children:["In this case, the ",(0,s.jsx)(n.code,{children:"type"})," remains ",(0,s.jsx)(n.code,{children:"vega"}),", but instead of using the ",(0,s.jsx)(n.em,{children:"config"})," field, you use the ",(0,s.jsx)(n.code,{children:"path"})," field to specify the location of the Vega specifications file."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'"components": {\n  "vegademo2": {\n    ...\n    "type": "vega",\n    "path": "demo-vega/specs/vegademo2.specs.json",\n    ...\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"user-interactions-and-data-passing",children:"User Interactions and Data Passing"}),"\n",(0,s.jsx)(n.p,{children:"One of the key reasons for using Vega for user studies is its ability to create interactive visualizations. For example, you can design stimuli that allow participants to interact with the visualization and capture their responses with little effort compared to using HTML or React stimuli. These responses can then be sent directly to reVISit for further processing."}),"\n",(0,s.jsxs)(n.p,{children:["To achieve this, you can use ",(0,s.jsx)(n.a,{href:"https://vega.github.io/vega/docs/signals/",children:"Vega signals"}),".\nSpecifically, a signal with the reserved name ",(0,s.jsx)(n.code,{children:"revisitAnswer"})," is used to pass participant responses to reVISit.\nHere's an example of how to define the ",(0,s.jsx)(n.code,{children:"revisitAnswer"})," signal:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'{\n  "name": "revisitAnswer",\n  "value": {},\n  "on": [\n    {\n      "events": "rect:click",\n      "update": "{responseId: \'vegaDemoResponse1\', response: datum.category}"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"In this example:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"events"})," field specifies the user interaction to listen for (",(0,s.jsx)(n.code,{children:"rect:click"})," in this instance)."]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"update"})," field defines the response structure, which includes a ",(0,s.jsx)(n.code,{children:"responseId"})," and the participant's selection (e.g., ",(0,s.jsx)(n.code,{children:"datum.category"}),"). The ",(0,s.jsx)(n.code,{children:"responseId"})," should match the id in your response field described below."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Ensure that you are using Vega when adding signals. If you are using Vega-Lite, you can convert your specifications to lower-level Vega specifications to add signals."})}),"\n",(0,s.jsx)(n.h3,{id:"capturing-responses",children:"Capturing Responses"}),"\n",(0,s.jsxs)(n.p,{children:["Once the signal is defined in your Vega specifications, you can configure the response field in the reVISit configuration. By setting the response type to ",(0,s.jsx)(n.code,{children:"iframe"}),", the signal emitted by the Vega component is captured and sent to the reVISit platform."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'{\n  ...\n  "response": [\n    {\n      "id": "vegaDemoResponse1",\n      "prompt": "You selected:",\n      "location": "sidebar",\n      "type": "iframe"\n    }\n  ]\n  ...\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"This setup ensures that the participant's interaction with the visualization is seamlessly recorded and displayed in the reVISit interface."}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Make sure that the ",(0,s.jsx)(n.code,{children:"response.id"})," matches the one in vega signal's ",(0,s.jsx)(n.code,{children:"responseId"}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"example-config-with-complete-vega-specifications",children:"Example Config with Complete Vega Specifications"}),"\n",(0,s.jsx)(n.p,{children:"Below is an example (partial \u2013\xa0the component part) configuration for a study with a bar chart including a complete Vega specification.\nIn this setup, participants are asked to select the highest bar.\nWhen a bar is clicked, the response is sent to reVISit and rendered in the sidebar.\nAn additional prompt is added to assess how confident participants are in their answers.\nThe figure shows the result:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"The reVISit UI showing a Vega bar chart where one bar is selected and the response is printed in the sidebar.",src:i(41020).A+"",width:"1498",height:"728"})}),"\n",(0,s.jsxs)(n.p,{children:["Remember that all events in this example are fully tracked, so you can inspect the interactions of each participants in the ",(0,s.jsx)(n.a,{href:"https://revisit.dev/study/analysis/stats/demo-vega/replay",children:"replay view"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'"components": {\n  "vegademo1": {\n    "meta": {\n      "metadata": 1\n    },\n    "description": "Select the highest bar.",\n    "instruction": "Click on the bar with the highest value.",\n    "type": "vega",\n    "config": {\n      "$schema": "https://vega.github.io/schema/vega/v5.json",\n      "width": 400,\n      "height": 200,\n      "padding": {\n        "left": 5,\n        "right": 5,\n        "top": 5,\n        "bottom": 5\n      },\n      "data": [\n        {\n          "name": "table",\n          "values": [\n            {\n              "category": "A",\n              "amount": 28\n            },\n            {\n              "category": "B",\n              "amount": 55\n            },\n            {\n              "category": "C",\n              "amount": 43\n            },\n            {\n              "category": "D",\n              "amount": 91\n            },\n            {\n              "category": "E",\n              "amount": 81\n            },\n            {\n              "category": "F",\n              "amount": 53\n            },\n            {\n              "category": "G",\n              "amount": 19\n            },\n            {\n              "category": "H",\n              "amount": 87\n            }\n          ]\n        }\n      ],\n      "config": {\n        "signals": [\n          {\n            "name": "tooltip",\n            "value": {},\n            "on": [\n              {\n                "events": "rect:mouseover",\n                "update": "datum"\n              },\n              {\n                "events": "rect:mouseout",\n                "update": "{}"\n              }\n            ]\n          },\n          {\n            "name": "revisitAnswer",\n            "value": {},\n            "on": [\n              {\n                "events": "rect:click",\n                "update": "{responseId: \'vegaDemoResponse1\', response: datum.category}"\n              }\n            ]\n          }\n        ]\n      },\n      "scales": [\n        {\n          "name": "xscale",\n          "type": "band",\n          "domain": {\n            "data": "table",\n            "field": "category"\n          },\n          "range": "width"\n        },\n        {\n          "name": "yscale",\n          "domain": {\n            "data": "table",\n            "field": "amount"\n          },\n          "nice": true,\n          "range": "height"\n        }\n      ],\n      "axes": [\n        {\n          "orient": "bottom",\n          "scale": "xscale"\n        },\n        {\n          "orient": "left",\n          "scale": "yscale"\n        }\n      ],\n      "marks": [\n        {\n          "type": "rect",\n          "from": {\n            "data": "table"\n          },\n          "encode": {\n            "enter": {\n              "x": {\n                "scale": "xscale",\n                "field": "category",\n                "offset": 1\n              },\n              "width": {\n                "scale": "xscale",\n                "band": 1,\n                "offset": -1\n              },\n              "y": {\n                "scale": "yscale",\n                "field": "amount"\n              },\n              "y2": {\n                "scale": "yscale",\n                "value": 0\n              }\n            },\n            "update": {\n              "fill": [\n                {\n                  "test": "datum.category === tooltip.category",\n                  "value": "red"\n                },\n                {\n                  "value": "steelblue"\n                }\n              ]\n            }\n          }\n        },\n        {\n          "type": "text",\n          "encode": {\n            "enter": {\n              "align": {\n                "value": "center"\n              },\n              "baseline": {\n                "value": "bottom"\n              },\n              "fill": {\n                "value": "#333"\n              }\n            },\n            "update": {\n              "x": {\n                "scale": "xscale",\n                "signal": "tooltip.category",\n                "band": 0.5\n              },\n              "y": {\n                "scale": "yscale",\n                "signal": "tooltip.amount",\n                "offset": -2\n              },\n              "text": {\n                "signal": "tooltip.category"\n              },\n              "fillOpacity": [\n                {\n                  "test": "datum.category === tooltip.category",\n                  "value": 0\n                },\n                {\n                  "value": 1\n                }\n              ]\n            }\n          }\n        }\n      ]\n    },\n    "nextButtonLocation": "sidebar",\n    "response": [\n      {\n        "id": "vegaDemoResponse1",\n        "prompt": "You selected:",\n        "location": "sidebar",\n        "type": "iframe"\n      },\n      {\n        "id": "vegaDemoConfidence1",\n        "prompt": "How confident are you with your answer?",\n        "location": "sidebar",\n        "type": "slider",\n        "options": [\n          {\n            "label": "Low",\n            "value": 0\n          },\n          {\n            "label": "High",\n            "value": 100\n          }\n        ]\n      }\n    ]\n  }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},41020:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/vega-response-84c399aea0458bcb7fc6bc7f9020a9a0.png"},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>r});var t=i(96540);const s={},a=t.createContext(s);function o(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);