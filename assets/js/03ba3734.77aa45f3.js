"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[55436],{23912:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"designing-studies/react-stimulus","title":"Designing a React Stimulus","description":"React is a popular JavaScript library for building user interfaces, primarily for single-page applications. You can find more details on the official React documentation.","source":"@site/docs/designing-studies/react-stimulus.md","sourceDirName":"designing-studies","slug":"/designing-studies/react-stimulus","permalink":"/docs/designing-studies/react-stimulus","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Designing an HTML Stimulus","permalink":"/docs/designing-studies/html-stimulus"},"next":{"title":"Designing a VEGA Stimulus","permalink":"/docs/designing-studies/vega-stimulus"}}');var i=t(74848),a=t(28453);const r={},c="Designing a React Stimulus",o={},l=[{value:"Example 1: Graphical Perception Experiment",id:"example-1-graphical-perception-experiment",level:2},{value:"Example 2: Click Accuracy Experiment",id:"example-2-click-accuracy-experiment",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"designing-a-react-stimulus",children:"Designing a React Stimulus"})}),"\n",(0,i.jsxs)(n.p,{children:["React is a popular JavaScript library for building user interfaces, primarily for single-page applications. You can find more details on the official ",(0,i.jsx)(n.a,{href:"https://react.dev/",children:"React documentation"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Here we will introduce how to create a React stimulus for reVISit studies through two examples."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example 1"})," is a stimulus from the ",(0,i.jsx)(n.a,{href:"https://scholar.google.com/scholar?hl=en&as_sdt=0%2C5&q=Graphical+perception%3A+Theory%2C+experimentation%2C+and+application+to+the+development+of+graphical+methods&btnG=",children:"graphical perception experiment"}),". This example will demonstrate how to pass data from the config file to the stimulus."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example 2"})," is a stimulus for the click accuracy test. This example will demonstrate how to retrieve user answers from the React component."]}),"\n",(0,i.jsx)(n.h2,{id:"example-1-graphical-perception-experiment",children:"Example 1: Graphical Perception Experiment"}),"\n",(0,i.jsxs)(n.p,{children:["The React component stimulus should be put into the ",(0,i.jsx)(n.code,{children:"src/public/your-exp-name/assets"})," folder. As stated in other tutorials, we suggest always making an ",(0,i.jsx)(n.code,{children:"assets"}),' directory inside your experiment directory for the best organization possible. In our example, we name the experiment "demo-cleveland," so we put this code into ',(0,i.jsx)(n.code,{children:"src/public/demo-cleveland/assets/BarChart.tsx"}),". Please replace it with another experiment name."]}),"\n",(0,i.jsxs)(n.p,{children:["We have a few reusable components and hooks available in the ",(0,i.jsx)(n.code,{children:"src/public/demo-cleveland/assets/hooks"})," and ",(0,i.jsx)(n.code,{children:"src/public/demo-cleveland/assets/chartcomponents"})," folders, which are required in this demo. These reusable components and hooks helps creating charts using D3.js in React. You may copy them to your own experiment folder."]}),"\n",(0,i.jsxs)(n.p,{children:["Please note, there is a ",(0,i.jsx)(n.strong,{children:'"parameters"'})," prop in the BarChart component. This is used to pass data from the config file to the React component.\nIn this example, we pass two data arrays to the BarChart component. One is the data array contains 5 objects, each object has a name and a value. The other is the selectedIndices array, which contains the indices of the data array that we want to highlight with dots."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import * as d3 from 'd3';\nimport { useChartDimensions } from './hooks/useChartDimensions';\nimport { Bars } from './chartcomponents/Bars';\nimport { NumericAxisV } from './chartcomponents/NumericAxisV';\nimport { OrdinalAxisHWithDotMarks } from './chartcomponents/OrdinalAxisHWithDotMarks';\n\n// Chart dimensions\nconst chartSettings = {\n  marginBottom: 40,\n  marginLeft: 40,\n  marginTop: 15,\n  marginRight: 15,\n  width: 400,\n  height: 400,\n};\n\n// This React component renders a bar chart with 5 bars and 2 of them highlighted by dots.\n// The data value comes from the config file and pass to this component by parameters.\nfunction BarChart({ parameters }: { parameters: any }) {\n  const tickLength = 6;\n  const [ref, dms] = useChartDimensions(chartSettings);\n\n    // Define axis scales\n    // Data comes from parameters is used here\n  const xScale = d3\n    .scaleBand()\n    .domain(parameters.data.map((d: { name: any }) => d.name))\n    .range([0, dms.boundedWidth])\n    .padding(0.2);\n\n  const yScale = d3\n    .scaleLinear()\n    .domain([100, 0])\n    .range([0, dms.boundedHeight]);\n\n  // Define ticks\n  const yAxisTickFilter = (ticks: any[]) => ticks.filter((t, i) => i === 0 || i === ticks.length - 1);\n\n  // selectedIndices is used here to draw dots on the x-axis\n  const xAxisTickFilter = (ticks: any[]) => ticks.filter((t, i) => parameters.selectedIndices.includes(i));\n\n  return (\n    <div className=\"Chart__wrapper\" ref={ref} style={{ height: 400 }}>\n      <svg width={dms.width} height={dms.height}>\n        <g\n          transform={`translate(${[dms.marginLeft, dms.marginTop].join(',')})`}\n        >\n          <g\n            transform={`translate(${[tickLength, dms.boundedHeight].join(\n              ',',\n            )})`}\n          >\n            <OrdinalAxisHWithDotMarks\n              domain={xScale.domain()}\n              range={xScale.range()}\n              withTick\n              tickLen={0}\n              tickFilter={xAxisTickFilter}\n            />\n          </g>\n          <g transform={`translate(${[0, 0].join(',')})`}>\n            <NumericAxisV\n              domain={yScale.domain()}\n              range={yScale.range()}\n              withTick\n              tickLen={tickLength}\n              tickFilter={yAxisTickFilter}\n            />\n          </g>\n          <g transform={`translate(${[0, 0].join(',')})`}>\n            <Bars\n              data={parameters.data}\n              xScale={xScale}\n              yScale={yScale}\n              height={dms.boundedHeight}\n            />\n          </g>\n        </g>\n      </svg>\n    </div>\n  );\n}\n\nexport default BarChart;\n"})}),"\n",(0,i.jsx)(n.p,{children:"In the config file, we will set parameters for the BarChart component.\nThe parameters contain data and selectedIndices. Both are decoded in the above code and used to create the stimulus."}),"\n",(0,i.jsx)(n.p,{children:"The parameters are an object; you can change the format to suit your needs."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:' "barChart": {\n            "meta": {\n                "difficulty": 5,\n                "chart": "Bar"\n            },\n            "description": "A chart with correct answer of 0.66",\n            "instruction": "Two values are marked with dots. \\n\\nWhat percentage do you believe the smaller value represents relative to the larger value?",\n            "type": "react-component",\n            "path": "demo-cleveland/assets/BarChart.tsx",\n            "parameters": {\n                "data": [\n                    {\n                        "name": "A",\n                        "value": "30"\n                    },\n                    {\n                        "name": "B",\n                        "value": "40"\n                    },\n                    {\n                        "name": "C",\n                        "value": "50"\n                    },\n                    {\n                        "name": "D",\n                        "value": "40"\n                    },\n                    {\n                        "name": "E",\n                        "value": "60"\n                    }\n                ],\n                "selectedIndices": [\n                    1,\n                    4\n                ]\n            },\n'})}),"\n",(0,i.jsx)(n.h2,{id:"example-2-click-accuracy-experiment",children:"Example 2: Click Accuracy Experiment"}),"\n",(0,i.jsx)(n.p,{children:"The click accuracy experiment requires participants to click on a moving dot on the screen. The dot will move inside a bounded box. The faster the dot moves, the more difficult it is for the participants to click on it."}),"\n",(0,i.jsx)(n.p,{children:"In this example, the response from the user is no longer the traditional response type that can be reused from reVISit. Instead, you will use the 'reactive' response type, which will receive the user's click data and send it to reVISit."}),"\n",(0,i.jsxs)(n.p,{children:["In this example, the React component will take ",(0,i.jsx)(n.code,{children:"parameters"})," and ",(0,i.jsx)(n.code,{children:"setAnswer"})," as props. The parameters work just like in Example 1; it will pass data from the config file to the React component.\nThe ",(0,i.jsx)(n.code,{children:"setAnswer"})," function is a built-in function that is used to pass the user's response to the reVISit framework."]}),"\n",(0,i.jsxs)(n.p,{children:["We will use 'demo-click-accuracy-test' as experiment name in this example. Start by creating the ",(0,i.jsx)(n.code,{children:"demo-click-accuracy-test"})," directory in the ",(0,i.jsx)(n.code,{children:"src/public"})," directory. Make sure to also add the ",(0,i.jsx)(n.code,{children:"assets"})," directory within the ",(0,i.jsx)(n.code,{children:"demo-click-accuracy-test"})," directory for the best organization."]}),"\n",(0,i.jsxs)(n.p,{children:["Now, create a new file called ",(0,i.jsx)(n.code,{children:"ClickAccuracyTest.tsx"})," with the following contents:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import * as d3 from 'd3';\nimport {\n  useCallback, useEffect, useState,\n} from 'react';\nimport { Box, Slider } from '@mantine/core';\nimport { useChartDimensions } from '../../demo-cleveland/assets/hooks/useChartDimensions';\nimport { StimulusParams } from '../../../store/types';\n\nconst chartSettings = {\n  marginBottom: 40,\n  marginLeft: 40,\n  marginTop: 15,\n  marginRight: 15,\n  height: 650,\n  width: 850,\n};\n\ninterface ClickAccuracyTest {\n  distance: number;\n  speed: number;\n  clickX: number;\n  clickY: number;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction ClickAccuracyTest({ parameters, setAnswer }: StimulusParams<any>) {\n    // useChartDimensions is a custom hook to create a chart with D3.js in React, you can find it in src/public/demo-cleveland/assets/hooks/useChartDimensions.ts\n  const [ref, dms] = useChartDimensions(chartSettings);\n  const [x, setX] = useState(100);\n  const [y, setY] = useState(100);\n  const [speed, setSpeed] = useState(300);\n  const { taskid } = parameters;\n\n  const clickCallback = useCallback((e: React.MouseEvent) => {\n    const circle = d3.select('#movingCircle');\n    const svg = d3.select('#clickAccuracySvg');\n    const pointer = d3.pointer(e, svg.node());\n    const circelPos = [+circle.attr('cx'), +circle.attr('cy')];\n    const distance = `${Math.round(Math.sqrt((pointer[0] - circelPos[0]) ** 2 + (pointer[1] - circelPos[1]) ** 2))}px`;\n    // This will record the distance between the click location and the center of the dot, passing answer to reVISit.\n    setAnswer({\n      answers: {\n          status: true,\n          [taskid]: distance,\n      },\n    });\n  }, [ setAnswer, taskid]);\n\n  // Making the moving dot\n  useEffect(() => {\n    const nxtX = Math.random() * 800;\n    const nxtY = Math.random() * 600;\n    const distance = Math.sqrt((nxtX - x) ** 2 + (nxtY - y) ** 2);\n    const time = (distance / speed) * 1000;\n    const svgElement = d3.select(ref.current);\n    svgElement.select('circle')\n      .transition()\n      .duration(time)\n      .ease(d3.easeLinear)\n      .attr('cx', nxtX)\n      .attr('cy', nxtY)\n      .on('end', () => {\n        setX(nxtX);\n        setY(nxtY);\n      });\n  }, [ref, speed, x, y]);\n\n  return (\n    <>\n      <div className=\"Chart__wrapper\" ref={ref} onClick={clickCallback} style={{ height: '650px' }}>\n        <svg id=\"clickAccuracySvg\" width={dms.width} height={dms.height}>\n          <g\n            transform={`translate(${[dms.marginLeft / 2, dms.marginTop / 2].join(\n              ',',\n            )})`}\n          >\n            <rect width=\"800\" height=\"600\" stroke=\"black\" strokeWidth=\"5\" fill=\"none\" />\n            <circle id=\"movingCircle\" cx=\"100\" cy=\"100\" r=\"10\" />\n\n          </g>\n        </svg>\n      </div>\n      <Box>\n        Adjust speed (px/s):\n        <Slider w={800} min={10} max={1000} value={speed} onChange={setSpeed} />\n\n      </Box>\n    </>\n\n  );\n}\n\nexport default ClickAccuracyTest;\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In the config file, we pass the ",(0,i.jsx)(n.code,{children:"taskid"})," and speed as parameters. Notice the response type for the trial is ",(0,i.jsx)(n.code,{children:"'reactive'"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"trial": {\n            "description": "try to click on the center of the moving dot",\n            "instruction": "Click on the moving dot",\n            "type": "react-component",\n            "path": "demo-click-accuracy-test/assets/ClickAccuracyTest.tsx",\n            "parameters": {\n                "speed": 100,\n                "taskid": "accuracy"\n            },\n            "nextButtonLocation": "sidebar",\n            "response": [\n                {\n                    "id": "accuracy",\n                    "prompt": "Your click distance to circle center",\n                    "required": true,\n                    "location": "sidebar",\n                    "type": "reactive"\n                }\n            ]\n        }\n'})}),"\n",(0,i.jsx)(n.p,{children:"At this point, the click accuracy test will be running and be able to collect participant's data."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var s=t(96540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);